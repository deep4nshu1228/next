import pandas as pd

# df = pd.read_csv('cleaned.csv')

# Ensure dtypes
df["WARRANTY_CLAIM_DATE"] = pd.to_datetime(df["WARRANTY_CLAIM_DATE"], errors="coerce")
df["WARRANTY_COST"] = pd.to_numeric(df["WARRANTY_COST"], errors="coerce")

# Extract year
df["claim_year"] = df["WARRANTY_CLAIM_DATE"].dt.year

# Aggregate
yearly_cost = (
    df.groupby("claim_year")["WARRANTY_COST"]
      .sum(min_count=1)
      .reset_index(name="total_warranty_cost")
      .sort_values("claim_year")
)

# Optional: add counts
yearly_counts = (
    df.groupby("claim_year")
      .size()
      .reset_index(name="total_claims")
)

yearly_summary = yearly_cost.merge(yearly_counts, on="claim_year", how="left")

# Save
yearly_summary.to_csv("warranty_cost_by_year.csv", index=False)
yearly_summary.head()
