from lightgbm import LGBMClassifier
from sklearn.metrics import classification_report, confusion_matrix, ConfusionMatrixDisplay, accuracy_score, f1_score
import matplotlib.pyplot as plt

lgbm = LGBMClassifier(
    objective='multiclass',
    num_class=len(le.classes_),
    n_estimators=500,
    learning_rate=0.05,
    num_leaves=31,
    max_depth=-1,
    subsample=0.8,
    colsample_bytree=0.8,
    random_state=42,
    n_jobs=-1
)

lgbm.fit(X_train_bal, y_train_bal)

y_pred = lgbm.predict(X_test_proc)

y_test_labels = le.inverse_transform(y_test)
y_pred_labels = le.inverse_transform(y_pred)

print("LightGBM LGBMClassifier report:")
print(classification_report(y_test_labels, y_pred_labels))

acc = accuracy_score(y_test_labels, y_pred_labels)
f1w = f1_score(y_test_labels, y_pred_labels, average='weighted')
print(f"Accuracy: {acc:.4f} | Weighted F1: {f1w:.4f}")

cm = confusion_matrix(y_test_labels, y_pred_labels, labels=le.classes_)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=le.classes_)
disp.plot(cmap='Blues', xticks_rotation=45)
plt.title('Confusion Matrix - LightGBM')
plt.show()
